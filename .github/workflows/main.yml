name: Daily Gemini Blog Update

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š 8:00 è¿è¡Œ (UTC 00:00)
    - cron: '0 5 * * *'
  # æ”¯æŒæ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®æ‰§è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•
  workflow_dispatch:

# ã€å…³é”®ã€‘èµ‹äºˆæœºå™¨äººå†™å…¥ä»“åº“å†…å®¹çš„æƒé™ï¼Œå¦åˆ™ä¼šæŠ¥ Exit Code 1
permissions:
  contents: write

jobs:
  build_and_post:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»“åº“ä»£ç 
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. å®‰è£… Python ç¯å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. å®‰è£… Gemini å®˜æ–¹åº“
      - name: Install Dependencies
        run: pip install google-generativeai

      # 4. è¿è¡Œç”Ÿæˆæ–‡ç« çš„è„šæœ¬
      - name: Run Gemini Script
        env:
          # ã€å…³é”®ã€‘ç¡®ä¿è¿™é‡Œçš„åå­—å’Œä½  GitHub Secrets é‡Œè®¾ç½®çš„ä¸€æ¨¡ä¸€æ ·
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python scripts/update_blog.py

      # 5. æäº¤å¹¶æ¨é€æ–°æ–‡ç« 
      - name: Commit and Push Changes
        run: |
          # é…ç½®æœºå™¨äººèº«ä»½
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ–‡ä»¶äº§ç”Ÿ
          git add content/posts/*.md
          
          # ã€æ ¸å¿ƒé€»è¾‘ã€‘åªæœ‰å½“ç¡®å®æœ‰æ–‡ä»¶æ”¹åŠ¨æ—¶æ‰æ‰§è¡Œ commitï¼Œé˜²æ­¢å› â€œæ— æ”¹åŠ¨â€å¯¼è‡´çš„ Exit Code 1
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "chore: ğŸ¤– æ¯æ—¥è‡ªåŠ¨æ›´æ–°æ–‡ç«  [$(date +'%Y-%m-%d')]"
            git push
          else
            echo "æ²¡æœ‰æ£€æµ‹åˆ°æ–°æ–‡ç« ç”Ÿæˆï¼Œè·³è¿‡æäº¤ã€‚"
          fi
